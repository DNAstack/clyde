<!--
hugo OpenAPI reference documentation generator
Params:
  url: the public URL of the OpenAPI .json specification
Generates reference documentation based on the provided OpenAPI specification. Use with: {{/*
  {{< generate-openapi-ref-docs url="your-.json-file-url" >}}
  */}}
  Example: {{/*
  {{< generate-openapi-ref-docs url="https://raw.githubusercontent.com/github/rest-api-description/main/descriptions/api.github.com/api.github.com.json" >}}
  */}}
If your OpenAPI spec is not hosted at an accessible url endpoint, you can
store a copy of your OpenAPI specification in the root-level site /data folder.
Then delete the first and last lines of the code block below, and replace the
$openapi variable declaration at the beginning with: {{/*
{{ $openapi := .Site.Data.fileName }}
*/}}
where fileName is the file's name with `.json` removed from the end
 -->
{{ with $.Params.url }}
  {{ $openapi := $.Site.Data.api_spec }}
  <div class="$openapi-spec-content">
    <h4>{{ $openapi.info.title }} Version {{ $openapi.info.version }}</h4>
    <div class="description">
      <p>{{ $openapi.info.description }}</p>
    </div>
    <div style="display: flex; flex-direction: column; align-items: stretch; width: 100%;">
      {{ range $path, $pathMethods := $openapi.paths }}
        {{ range $pathMethod, $pathDetails := $pathMethods }}
          <div style="display: flex; flex-direction: column; width: 100%; border: 1px solid black;">
            <div style="display: flex; flex-direction: row; width: 100%; overflow: auto;">
              <div style="width: 45%; padding: 10px;">
                <h4><span style="text-transform: uppercase;">{{ $pathMethod }}</span>&nbsp;&nbsp;<span style="color: #e83e8c;">{{ $path }}</span></h4>
                <h5>{{ $pathDetails.summary }}</h5>
                <p><a href="{{ $pathDetails.externalDocs.url }}">{{ $pathDetails.externalDocs.description}}</a></p>
                <p>Description: {{ $pathDetails.description | markdownify }}</p>
                {{ range $index, $element := $pathDetails.security }}
                  {{ $security := index $pathDetails.security $index }}
                    {{ range $key, $value := $security }}
                      <p>Security: {{ index $value 0 }}</p>
                    {{ end }}
                {{ end }}
              </div>
              <div style="width: 55%; padding: 10px 15px 10px 0; display: flex; flex-direction: column;">
                {{ range $responseCode, $responseDetails := $pathDetails.responses }}
                  {{ if isset $responseDetails "content" }}
                    {{ range $schemaName, $schema := (index $responseDetails.content "application/json").schema }}
                      {{ if isset $schema "$ref" }}
                        {{ $refPath := index $schema "$ref" }}
                        {{ range $index, $component := last 1 (split $refPath "/") }}
                          {{ if (index $openapi.components.schemas $component) }}
                            <div style="font-weight: bold; max-height: calc(100%); overflow: auto;">
                              <h4>Response Code: <span style="color: #e83e8c;">{{ $responseCode }}</span></h4>
                              <p>Description: {{ $responseDetails.description | markdownify}}</p>
                              <h6>Schema:</h6>
                              <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f9f9fa"><code>{{ index $openapi.components.schemas $component | jsonify (dict "indent" "  ") }}</code></pre>
                            </div>
                          {{ end }}
                        {{ end }}
                      {{ else }}
                        {{ range $schemaName, $schema := index $responseDetails.content "application/json" }}
                          {{ if isset $schema "$ref" }}
                            {{ $refPath := index $schema "$ref" }}
                            {{ range $index, $component := split $refPath "/" }}
                              {{ if (index $openapi.components.schemas $component) }}
                                <div style="font-weight: bold; max-height: calc(100%); overflow: auto;">
                                  <h4>Response Code: <span style="color: #e83e8c;">{{ $responseCode }}</span></h4>
                                  <p>Description: {{ $responseDetails.description | markdownify}}</p>
                                  <h6>Schema:</h6>
                                  <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f9f9fa"><code>{{ index $openapi.components.schemas $component | jsonify (dict "indent" "  ") }}</code></pre>
                                </div>
                              {{ end }}
                            {{ end }}
                          {{ end }}
                        {{ end }}
                      {{ end }}
                    {{ end }}
                  {{ else }}
                    <div style="font-weight: bold; max-height: calc(80%); min-height: 60px; overflow: auto;">
                      <h4>Response Code: <span style="color: #e83e8c;">{{ $responseCode }}</span></h4>
                      <p>Description: {{ $responseDetails.description | markdownify}}</p>
                    </div>
                  {{ end }}
                {{ end }}
              </div>
            </div>
          </div>
        {{ end }}
      {{ end }}
    </div>
  </div>
{{ end }}
